<html>
<body>
<LINK REL="stylesheet" type="text/css" HREF="../default.css">
<head><title>On Socklisten</title></head>
<H1>On Socklisten</H1>
<br>
<br>
The <b>ON SOCKLISTEN</b> event triggers when a connection is made on a listening <a href="..\sockets\sockets.html">TCP socket</a> created with <a href="..\commands\socklisten.html">/socklisten</a>


<H4>Synopsis</H4>
<pre class = "code">ON &lt;level&gt;:SOCKLISTEN:&lt;matchtext&gt;:&lt;commands&gt;</pre>

<H4>Parameters</H4>
<b>&lt;matchtext&gt;</b> - The name of the socket you want event to trigger on.
<br><b>&lt;commands&gt;</b> - The commands to be performed when the event listener's criteria is met.

== Accepting a connection ==

<br><b>Note:</b> By design, you cannot prevent a socket from being accepted, as in, Windows accepts the connection even before mIRC.

You can use /sockaccept &lt;newsocket&gt; to accept a socket, mIRC create the new socket.

<br><b>Note:</b> If a new connection occurs on a listening socket but there is no on socklisten event matching that socket, the connection is rejected.

You should be checking for $sockerr before accepting the connection to see if an error occurred, here is a list of the possible value for $sockerr in the on SOCKLISTEN event:

<br><b>0</b> - New socket successfully accepted.
<br><b>1</b> - Error occurred on listening socket, $sock().wsmsg will contain a more specific error message. Note that getting this error is considered rare.
<br><b>2</b> - Error accepting new socket, $sock().wsmsg will contain a more specific error message.
<br><b>4</b> - Not enough memory for new socket. Note that getting this error is considered rare.

<H4>Example</H4>

<pre class ="code">
on *:socklisten:name:{
  if (!$sockerr) sockaccept myprefix $+ $ticks
  else {
    echo -s An error occurred while trying to accept a connection: $sock($sockname).wsmsg
  }
}
</pre>

<H4>Compatibility</H4>
Added: mIRC v5.3 (13 Dec 1997)

<H4>Notes</H4>
None

<H4>See also</H4>

<a href="on_sockopen.html">On_SockOpen</a><br>
<a href="on_sockread.html">On_SockRead</a><br>
<a href="on_sockwrite.html">On_SockWrite</a><br>
<a href="on_sockclose.html">On_SockClose</a><br>
<a href="..\commands\sockwrite.html">/sockwrite</a><br>
<a href="..\commands\sockclose.html">/sockclose</a><br>
<a href="..\commands\sockread.html">/sockread</a><br>
<a href="..\commands\sockaccept.html">/sockaccept</a><br>
<a href="..\commands\sockpause.html">/sockpause</a><br>
<a href="..\identifiers\sock.html">$sock</a><br>
<a href="..\identifiers\sockbr.html">$sockbr</a><br>
<a href="..\identifiers\sockerr.html">$sockerr</a><br>
</body>
</html>
