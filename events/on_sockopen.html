<html>
<body>
<LINK REL="stylesheet" type="text/css" HREF="../default.css">
<H1>On Sockopen</H1>
<br>
<br>
The <b>ON SOCKOPEN</b> event triggers when a TCP socket connection initiated with {{mIRC|/sockopen}} is either successfull or failed. This event also trigger after an SSL negociation (STARTTLS feature) is finished, you can check $sock().starttls which will be set to $true if the negociation was successful.

<H4>Synopsis</H4>
<pre>ON &lt;level&gt;:SOCKOPEN:&lt;matchtext&gt;:&lt;commands&gt;</pre>

<H4>Parameters</H4>
'''&lt;matchtext&gt;'''</span>The name of the socket you want the event to trigger on.

<br><b>&lt;commands&gt;</b> - The commands to be performed when the event listener's criteria is met.

== Connection State ==

Because the sockopen event triggers for failed connections as well as successful connections, it's important to check the value of {{mIRC|$sockerr}} before continuing with any commands. Here is a list of the possible values returned by $sockerr in the on SOCKOPEN event:

* '''0''' - Success.
* '''3''' - Failure establishing socket connection: $sock($sockname).wsmsg will contain a more specific error message.
* '''4''' - Error resolving given hostname.

== Examples ==

<pre class ="code">
on *:sockopen:example:{

  ;if an error occurred ($sockerr is not 0)
  if ($sockerr) {
    if ($sockerr == 3) {
      echo -s An error occurred while trying to connect: $sock($sockname).wsmsg
    }
    elseif ($sockerr == 4) {
      echo -s Error resolving hostname
    }
  }

  ;no error occurred ($sockerr was 0)
  else {
    ;perform commands after establishing a connection.
    ;usually this involves making a request for a webpage as shown below:
    sockwrite -n $sockname GET / HTTP/1.1
    sockwrite -n $sockname Host: www.example.com
    sockwrite -n $sockname Connection: close
    sockwrite    $sockname $crlf
  }
}
</pre>

<H4>Compatability</H4>
{{mIRC compatibility|3.5}}

== See Also ==
* {{mirc|on events/on sockread|on sockread}}
* {{mirc|on events/on sockwrite|on sockwrite}}
* {{mirc|on events/on socklisten|on socklisten}}
* {{mirc|on events/on sockclose|on sockclose}}
* {{mIRC|/sockopen}}
* {{mIRC|/sockwrite}}
* {{mIRC|/sockread}}
* {{mIRC|/sockclose}}
* {{mIRC|/sockaccept}}
* {{mIRC|/sockpause}}
* {{mIRC|$sockname}}
* {{mIRC|$sock}}
* {{mIRC|$sockbr}}
* {{mIRC|$sockerr}}

[[Category:mIRC on events|sockopen]]</body>
</html>
